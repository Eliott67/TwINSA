{% extends "base.html" %}
{% block title %}Feed - TwINSA{% endblock %}

{% block content %}


<style>
  /* --- Notifications sidebar --- */
  .notif-toggle {
    position: fixed;
    top: 1rem;
    left: 1rem;
    z-index: 1100;
    border: none;
    background: #111827;
    color: #f9fafb;
    padding: 0.4rem 0.8rem;
    border-radius: 999px;
    cursor: pointer;
    font-size: 1.1rem;
  }

  .notif-sidebar {
    position: fixed;
    top: 0;
    left: -260px; /* hidden by default */
    width: 260px;
    height: 100vh;
    background: #111827;
    color: #f9fafb;
    padding: 1rem;
    box-shadow: 2px 0 8px rgba(0,0,0,0.3);
    transition: left 0.3s ease;
    z-index: 1000;
    overflow-y: auto;
  }

  .notif-sidebar.open {
    left: 0;
  }

  .notif-sidebar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .notif-sidebar-header h3 {
    margin: 0;
    font-size: 1.1rem;
  }

  .notif-count {
    background: #f97316;
    border-radius: 999px;
    padding: 0.1rem 0.6rem;
    font-size: 0.8rem;
  }

  .notif-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .notif-item {
    padding: 0.6rem 0.4rem;
    border-bottom: 1px solid rgba(249,250,251,0.1);
    font-size: 0.9rem;
    line-height: 1.3;
  }

  .notif-item:last-child {
    border-bottom: none;
  }

  .notif-empty {
    padding: 0.4rem;
    font-size: 0.9rem;
    color: #9ca3af;
  }

  /* Just moves your feed a bit to the right so it‚Äôs not under the bell */
  .feed-main-with-notifs {
    padding-left: 3.5rem;
  }

  @media (max-width: 600px) {
    .feed-main-with-notifs {
      padding-left: 3rem;
    }
  }
</style>


<!-- üîî Bell to open the sidebar -->
<button class="notif-toggle" id="notifToggle">üîî</button>

<!-- Left sliding sidebar -->
<aside class="notif-sidebar" id="notifSidebar">
  <div class="notif-sidebar-header">
    <h3>Notifications</h3>
    <span class="notif-count">{{ notifications|length }}</span>
  </div>

  <ul class="notif-list">
    {% if notifications %}
      {% for n in notifications %}
        <li class="notif-item">{{ n }}</li>
      {% endfor %}
    {% else %}
      <li class="notif-empty">No notifications yet.</li>
    {% endif %}
  </ul>
</aside>

<!-- üëá NEW wrapper, your existing feed goes inside -->
<div class="feed-main-with-notifs">


  <!-- Barre du haut avec boutons profil et log out et recherche -->
  <div class="feed-header-top">
    <h2>Welcome, {{ username }} üëã</h2>
    <div class="feed-header-buttons">
      <a href="{{ url_for('profile', username=username) }}" class="btn profile-btn">Profile</a>
      <a href="{{ url_for('search_users') }}" class="btn search-btn">Search</a>
      <a href="{{ url_for('logout') }}" class="btn logout-btn">Log out</a>
    </div>
  </div>

  <div class="feed-container">
    <!-- Formulaire pour poster -->
    <form method="POST" class="tweet-form" id="tweetForm">
      <textarea id="tweetBox" name="tweet" maxlength="180" placeholder="What's happening?" required></textarea>
      <div class="tweet-footer">
        <span id="charCount">0 / 180</span>
        <button type="submit">Post</button>
      </div>
    </form>

    <hr>

    <!-- Liste des posts -->
    <div class="tweets">
      {% if tweets %}
        {% for tweet in tweets %}
          {% set _ = tweet.update({'index': loop.index0}) %}
          <div class="tweet">
            <strong>@{{ tweet.poster_username }}</strong>
            <p>{{ tweet.content }}</p>
            <small>{{ tweet.date }}</small>

            <!-- Zone de likes -->
            <div class="tweet-actions">
              <a href="{{ url_for('like', post_index=loop.index0) }}" class="like-btn">
                ‚ù§Ô∏è {{ tweet.likes|length }}
              </a>
            </div>

            <!-- Zone de commentaires -->
            <div class="tweet-comments">
              {% if tweet.comments %}
                {% for c in tweet.comments %}
                  <div class="comment">
                    <div class="comment-header">
                      <strong>@{{ c.username }}</strong>
                      {% if c.username == username %}
                        <a href="{{ url_for('delete_comment', post_index=tweet.index, comment_index=loop.index0) }}" class="delete-comment">üóëÔ∏è</a>
                      {% endif %}
                    </div>
                    <p>{{ c.comment }}</p>
                    <small>{{ c.date }}</small>
                  </div>
                {% endfor %}
              {% endif %}

              <!-- Formulaire de commentaire -->
              <form action="{{ url_for('comment', post_index=loop.index0) }}" method="POST" class="comment-form">
                <input type="text" name="comment" placeholder="Add a comment..." maxlength="120">
                <button type="submit" class="comment-btn">üí¨</button>
              </form>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>No posts yet. Be the first to post!</p>
      {% endif %}
    </div>
  </div>
</div> 

<!-- Script compteur -->
<script>

  // Sidebar toggle
  const notifToggle = document.getElementById('notifToggle');
  const notifSidebar = document.getElementById('notifSidebar');

  if (notifToggle && notifSidebar) {
    notifToggle.addEventListener('click', () => {
      notifSidebar.classList.toggle('open');
    });
  }

const tweetBox = document.getElementById('tweetBox');
const charCount = document.getElementById('charCount');

tweetBox.addEventListener('input', () => {
  const length = tweetBox.value.length;
  charCount.textContent = `${length} / 180`;
  charCount.style.color = length > 160 ? '#ff4d4d' : '#aaa';
});
</script>
{% endblock %}
