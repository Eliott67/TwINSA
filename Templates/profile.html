{% extends "base.html" %}
{% block title %}Profile - TwINSA{% endblock %}

{% block content %}
<div class="profile-container">
  {% if current_user.username == user.username %}
  <div class="profile-header">
    <h2>Your Profile</h2>
    <a href="{{ url_for('feed') }}" class="btn back-btn">← Back to Feed</a>
  </div>

  <form method="POST" class="profile-form">
    <label>Name</label>
    <input type="text" name="name" value="{{ user.name or '' }}" placeholder="Your name">

    <label>Age</label>
    <input type="number" name="age" value="{{ user.age or '' }}" placeholder="Your age">

    <label>Country</label>
    <input type="text" name="country" value="{{ user.country or '' }}" placeholder="Your country">

    <button type="submit" class="btn-save">Save Changes</button>
  </form>

  <hr>

  <form action="{{ url_for('delete_account_route') }}" method="POST" class="delete-form">
    <h3>Delete Account</h3>
    <p>This action is irreversible.</p>
    <input type="password" name="password" placeholder="Confirm your password" required>
    <button type="submit" class="btn-delete">Delete My Account</button>
  </form>
  
  {% else %}
  <div class="profile-header">
    <h2>{{ user.username }}'s Profile</h2>
    <a href="{{ url_for('search_users') }}" class="btn back-btn">← Back to Search</a>
  </div>

  {% if can_view %}
   <p><strong>Name:</strong> {{ user.name }}</p>
  <p><strong>Age:</strong> {{ user.age }}</p>
  <p><strong>Country:</strong> {{ user.country }}</p>
  <p><strong>Account Type:</strong> {{ 'Public' if user.is_public else 'Private' }}</p>

  <div class="profile-actions">
    {% if current_user.follows(user) %}
      <form action="{{ url_for('unfollow_user', username=user.username) }}" method="POST">
        <button type="submit" class="btn">Unfollow</button>
      </form>
    {% else %}
      <form action="{{ url_for('follow_user', username=user.username) }}" method="POST">
        <button type="submit" class="btn">Follow</button>
      </form>
    {% endif %}

    {% if current_user.blocks(user) %}
      <form action="{{ url_for('unblock_user', username=user.username) }}" method="POST">
        <button type="submit" class="btn">Unblock</button>
      </form>
    {% else %}
      <form action="{{ url_for('block_user', username=user.username) }}" method="POST">
        <button type="submit" class="btn">Block</button>
      </form>
    {% endif %}
  </div>

  <div class="followers-following">
    <a href="{{ url_for('view_followers', username=user.username) }}">View Followers</a> |
    <a href="{{ url_for('view_following', username=user.username) }}">View Following</a>
  </div>

  {% else %}
  <p>This account is private. Follow the user to see more information.</p>
  <div class="profile-actions">
    <form action="{{ url_for('send_follow_request', username=user.username) }}" method="POST">
      <button type="submit" class="btn">Send Follow Request</button>
    </form>

    {% if current_user.blocks(user) %}
      <form action="{{ url_for('unblock_user', username=user.username) }}" method="POST">
        <button type="submit" class="btn">Unblock</button>
      </form>
    {% else %}
      <form action="{{ url_for('block_user', username=user.username) }}" method="POST">
        <button type="submit" class="btn">Block</button>
      </form>
    {% endif %}
  </div>
  {% endif %}
  {% endif %}

</div>
{% endblock %}
